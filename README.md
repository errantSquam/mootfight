# Welcome to Mootfight!
An open-source self-hosted Artfight clone. (name tentative...)

# Frontend
## Dev Setup
Only required if you're contributing to the codebase! Also, do everything mentioned in **Hosting Setup.**
### Install
1. Pull repo
2. cd into frontend folder
3. ``npm install``

### Note to Contributors
PRs are welcome! But please don't make PRs with AI generated code, thanks

## Hosting Setup

### Creating a new account
1. In the Firebase console, go to Authentication.
2. (FIRST TIME SETUP) Under the 'Sign-in method' tab, enable 'Email/Password' as a provider if you haven't already.
3. Under the 'Users' tab, click on 'Add User', and fill in the e-mail and generic password.
4. Click the three dots on the newly-created user and click 'Reset Password' to send a password reset email.

### Firebase db
Make an .env file and add a firebase key. It should be something like this:

**(Note that this is a string, not a JSON, or several .env variables.** Thus, wrap your Firebase key in quotes. This is because the Firebase app takes in an initial JSON object, so we're going to have it be parsed into a usable JSON by Javascript.)
```
REACT_APP_FIREBASE_KEY = '{
  "apiKey": "APIKEY",
  "authDomain": "AUTHDOMAIN",
  "projectId": "PROJID,"
  "storageBucket": "STORAGEBUCKET",
  "messagingSenderId": "MESSAGINGSENDERID",
  "appId": "APPID",
  "measurementId": "MEASUREMENTID"
}'
```
Replace key with the one generated by your Firebase project.

#### Firestore Rules:
```
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false;
    }
    match /users/{userId} {
    	allow read: if true;
      allow update: if request.auth != null && request.auth.uid == userId 
      && request.resource.data.uid == resource.data.uid
      && request.resource.data.email == resource.data.email;
      allow create: if request.auth != null;
    }
    match /characters/{characterId} {
    	allow read: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.owner;
      allow create: if request.auth != null && request.resource.data.owner == request.auth.uid;
    }
    match /attacks/{attackId} {
    	allow read: if true;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.attacker;
      allow create: if request.auth != null && request.resource.data.attacker == request.auth.uid;
    }
  }
}
```

### Firestore Composite Indexes
**These are needed for certain queries to run.** Please set them under the 'Indexes' tab.

If any of these indexes don't work, please report them. There should be an error log in the console: `[FirebaseError: The query requires an index...]`

⬆️ denotes Ascending, ⬇️ denotes Descending.
| Collection ID | Fields Indexed |
| ------------- | -------------- |
| attacks | attacker ⬆️, creationDate ⬇️, __name__ ⬇️ |

#### Firebase requirements:
- Enable 'Authentication' for Email/Password
- Enable Firestore and create the following collections:
  - users
  - attacks


## Deployment
(to implement: https://github.com/gitname/react-gh-pages)
``npm run deploy``

## Known Vulnerabilities
Mootfight is meant to be hosted for a small group of trusted folks on a free Firebase plan, but we've done our best to validate the data as much as we can. Still, some validation checks are frontend-only and cannot be caught by Firebase's free plan. 

Here are some things to note:

### Not Backend Validated
- Profile picture is stored as a (base64) string, and the request can be modified to include any string.
- Image links are stored as strings, and only validated by the frontend. Requests can be modified to include any string, and if the image link breaks in the future, it will not be caught.

